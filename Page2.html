<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Message Chat</title>
<link rel="stylesheet" href="style3.css">
</head>
<body>

<div class="chat-container">
  <!-- Header -->
  <div class="chat-header">
    <h2>Message to this letter</h2>
  </div>

  <!-- Chat messages -->
  <div class="chat-box" id="chatBox"></div>

  <!-- Input area -->
  <div class="input-area">
    <input type="text" id="messageInput" placeholder="Type a message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<script>
const chatBox = document.getElementById('chatBox');
const input = document.getElementById('messageInput');
const STORAGE_KEY = 'chatMessages';

// Load saved messages
let messages = JSON.parse(localStorage.getItem(STORAGE_KEY) || '[]');
messages.forEach(msg => addMessageToChat(msg.text, msg.time));

function addMessageToChat(msg, time) {
  const div = document.createElement('div');
  div.className = 'message user';
  div.innerHTML = `<span class="msg-text">${escapeHtml(msg)}</span><span class="msg-time">${time}</span>`;
  chatBox.appendChild(div);
  chatBox.scrollTop = chatBox.scrollHeight;
}

function sendMessage() {
  const msg = input.value.trim();
  if(!msg) return;
  const timestamp = new Date().toLocaleTimeString([], {hour:'2-digit',minute:'2-digit'});
  addMessageToChat(msg, timestamp);
  messages.push({text: msg, time: timestamp});
  localStorage.setItem(STORAGE_KEY, JSON.stringify(messages));
  input.value = '';
  input.focus();
}

// Enter to send, Shift+Enter for newline
input.addEventListener('keydown', e => {
  if(e.key === 'Enter' && !e.shiftKey){
    e.preventDefault();
    sendMessage();
  }
});

// Escape HTML
function escapeHtml(text){
  const map = {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'};
  return text.replace(/[&<>"']/g, m => map[m]);
}
</script>

</body>
</html>
